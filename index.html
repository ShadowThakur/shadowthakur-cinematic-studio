<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>ShadowThakur â€” Cinematic Studio</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300;1,400&family=Syne:wght@400;600;700&family=JetBrains+Mono:wght@300;400&display=swap" rel="stylesheet"/>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --ink:#070708;--ash:#0e0e11;--smoke:#151518;--mist:#1c1c20;--veil:#252529;
  --ghost:#34343c;--fog:#5c5c72;--pale:#9898b2;--silk:#ccccde;--snow:#ebebf5;
  --gold:#c8a44a;--gold2:#e8c870;--gold-dim:rgba(200,164,74,.12);
  --ember:#e05530;--rose:#c04870;--teal:#3a8880;--purple:#7050b8;--green:#38a860;
  --r:.45rem;--r-lg:.85rem;
}
html,body{height:100%;background:var(--ink);color:var(--silk);font-family:'Syne',sans-serif;font-size:13px;overflow:hidden}
/* Grain texture */
body::before{content:'';position:fixed;inset:0;z-index:0;pointer-events:none;opacity:.25;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='.05'/%3E%3C/svg%3E")}
/* Top ambient glow */
body::after{content:'';position:fixed;top:-200px;left:50%;transform:translateX(-50%);
  width:700px;height:400px;z-index:0;pointer-events:none;
  background:radial-gradient(ellipse,rgba(200,164,74,.05) 0%,transparent 70%)}
.app{position:relative;z-index:1;height:100vh;display:grid;grid-template-rows:56px 1fr}

/* â”€â”€ HEADER â”€â”€ */
header{border-bottom:1px solid rgba(255,255,255,.04);padding:0 1.8rem;
  display:flex;align-items:center;justify-content:space-between;
  background:rgba(7,7,8,.9);backdrop-filter:blur(20px)}
.brand{display:flex;align-items:baseline;gap:.45rem}
.brand-name{font-family:'Cormorant Garamond',serif;font-size:1.4rem;font-weight:400;font-style:italic;color:var(--gold)}
.brand-sub{font-size:.52rem;font-weight:700;letter-spacing:.28em;text-transform:uppercase;color:var(--fog)}
.hdr-right{display:flex;align-items:center;gap:.8rem}
.yt-pill{display:flex;align-items:center;gap:.45rem;padding:.28rem .75rem;
  border:1px solid var(--ghost);border-radius:2rem;cursor:pointer;transition:all .2s}
.yt-pill:hover{border-color:var(--fog)}
.yt-pill.on{border-color:rgba(74,222,128,.3)}
.yt-dot{width:6px;height:6px;border-radius:50%;background:var(--ghost);transition:all .3s;flex-shrink:0}
.yt-dot.on{background:#4ade80;box-shadow:0 0 6px #4ade8055}
.yt-lbl{font-size:.58rem;font-weight:600;letter-spacing:.1em;text-transform:uppercase;color:var(--fog)}
.yt-pill.on .yt-lbl{color:#4ade80}

/* â”€â”€ MAIN 3-COL â”€â”€ */
main{display:grid;grid-template-columns:300px 1fr 270px;overflow:hidden}
.panel{overflow-y:auto;overflow-x:hidden;scrollbar-width:thin;scrollbar-color:var(--veil) transparent}
.panel::-webkit-scrollbar{width:3px}
.panel::-webkit-scrollbar-thumb{background:var(--veil)}

/* â”€â”€ LEFT PANEL â”€â”€ */
.panel-left{background:var(--ash);border-right:1px solid rgba(255,255,255,.035);
  padding:1.4rem 1.3rem;display:flex;flex-direction:column;gap:1.4rem}
.sec-label{font-size:.52rem;font-weight:700;letter-spacing:.28em;text-transform:uppercase;
  color:var(--fog);display:flex;align-items:center;gap:.5rem;margin-bottom:.6rem}
.sec-label::after{content:'';flex:1;height:1px;background:rgba(255,255,255,.04)}
.field{display:flex;flex-direction:column;gap:.35rem}
.flabel{font-size:.57rem;font-weight:600;letter-spacing:.14em;text-transform:uppercase;color:var(--fog)}
.key-wrap{position:relative}
input[type=text],input[type=password]{
  background:var(--smoke);border:1px solid rgba(255,255,255,.055);
  border-radius:var(--r);color:var(--silk);font-family:'Syne',sans-serif;
  font-size:.72rem;padding:.58rem .82rem;width:100%;outline:none;transition:border-color .2s}
input:focus{border-color:var(--gold)}
input::placeholder{color:var(--ghost)}
.eye-btn{position:absolute;right:.65rem;top:50%;transform:translateY(-50%);
  background:none;border:none;color:var(--fog);cursor:pointer;font-size:.68rem;padding:0}

.btn-gen{width:100%;padding:.85rem;
  background:linear-gradient(135deg,#c8a44a 0%,#9a7030 100%);
  border:none;border-radius:var(--r);cursor:pointer;
  font-family:'Syne',sans-serif;font-size:.72rem;font-weight:700;
  letter-spacing:.16em;text-transform:uppercase;color:#080808;
  transition:all .22s;position:relative;overflow:hidden}
.btn-gen::after{content:'';position:absolute;inset:0;
  background:linear-gradient(135deg,#e8c870,#c8a44a);opacity:0;transition:opacity .2s}
.btn-gen:hover::after{opacity:1}
.btn-gen:disabled{opacity:.32;cursor:not-allowed}
.btn-gen-inner{position:relative;z-index:1;display:flex;align-items:center;justify-content:center;gap:.4rem}

/* Render selected button */
.btn-render{width:100%;padding:.82rem;
  background:linear-gradient(135deg,#7050b8 0%,#4a3080 100%);
  border:none;border-radius:var(--r);cursor:pointer;
  font-family:'Syne',sans-serif;font-size:.7rem;font-weight:700;
  letter-spacing:.14em;text-transform:uppercase;color:#e8e4f4;
  transition:filter .2s;display:flex;align-items:center;justify-content:center;gap:.4rem}
.btn-render:hover{filter:brightness(1.15)}
.btn-render:disabled{opacity:.3;cursor:not-allowed}

.btn-regen{width:100%;padding:.68rem;background:transparent;
  border:1px solid var(--ghost);border-radius:var(--r);color:var(--pale);
  font-family:'Syne',sans-serif;font-size:.67rem;font-weight:600;
  letter-spacing:.12em;text-transform:uppercase;cursor:pointer;transition:all .2s;
  display:flex;align-items:center;justify-content:center;gap:.4rem}
.btn-regen:hover{border-color:var(--gold);color:var(--gold)}
.btn-regen:disabled{opacity:.28;cursor:not-allowed}

/* Selection summary */
.sel-summary{background:var(--smoke);border:1px solid rgba(255,255,255,.04);
  border-radius:var(--r);padding:.9rem;display:flex;flex-direction:column;gap:.55rem}
.sel-row{display:flex;align-items:flex-start;gap:.5rem}
.sel-icon{font-size:.75rem;flex-shrink:0;margin-top:.05rem}
.sel-text{font-size:.63rem;color:var(--pale);line-height:1.5;flex:1}
.sel-text.empty{color:var(--ghost);font-style:italic}
.sel-check{width:14px;height:14px;border-radius:50%;border:1px solid var(--ghost);
  flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:.5rem;
  transition:all .2s;margin-top:.1rem}
.sel-check.done{background:var(--gold);border-color:var(--gold);color:var(--ink)}

/* Meta card (post-render) */
.meta-card{background:var(--smoke);border:1px solid rgba(255,255,255,.04);
  border-radius:var(--r);padding:1rem;display:flex;flex-direction:column;gap:.75rem}
.script-l{font-family:'Cormorant Garamond',serif;font-style:italic;
  font-size:.95rem;font-weight:300;line-height:1.5;color:var(--snow)}
.meta-tags{display:flex;flex-wrap:wrap;gap:.28rem}
.tag{font-size:.52rem;font-weight:700;letter-spacing:.14em;text-transform:uppercase;
  padding:.16rem .5rem;border-radius:2rem;border:1px solid}
.tag-Pain{color:var(--rose);border-color:rgba(192,72,112,.38);background:rgba(192,72,112,.06)}
.tag-Realization{color:var(--gold);border-color:rgba(200,164,74,.38);background:rgba(200,164,74,.06)}
.tag-Growth{color:var(--teal);border-color:rgba(58,136,128,.38);background:rgba(58,136,128,.06)}
.tag-Ego{color:var(--ember);border-color:rgba(224,85,48,.38);background:rgba(224,85,48,.06)}
.tag-Calm{color:var(--purple);border-color:rgba(112,80,184,.38);background:rgba(112,80,184,.06)}
.meta-row{font-size:.57rem;color:var(--fog)}
.meta-row strong{color:var(--pale)}

select{background:var(--smoke);border:1px solid rgba(255,255,255,.055);
  border-radius:var(--r);color:var(--silk);font-family:'Syne',sans-serif;
  font-size:.72rem;padding:.58rem .82rem;width:100%;outline:none;appearance:none;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 5 5-5z' fill='%235c5c72'/%3E%3C/svg%3E");
  background-repeat:no-repeat;background-position:right .82rem center}
select:focus{border-color:var(--gold)}

.btn-upload{width:100%;padding:.78rem;background:#d00000;border:none;border-radius:var(--r);
  cursor:pointer;font-family:'Syne',sans-serif;font-size:.67rem;font-weight:700;
  letter-spacing:.12em;text-transform:uppercase;color:#fff;transition:filter .2s;
  display:flex;align-items:center;justify-content:center;gap:.45rem}
.btn-upload:hover{filter:brightness(1.12)}
.btn-upload:disabled{opacity:.32;cursor:not-allowed}
.upload-result{padding:.6rem .8rem;border-radius:var(--r);font-size:.63rem;line-height:1.5}
.upload-result.ok{background:rgba(56,168,96,.07);border:1px solid rgba(56,168,96,.22);color:var(--green)}
.upload-result.err{background:rgba(224,85,48,.07);border:1px solid rgba(224,85,48,.28);color:var(--ember)}

/* â”€â”€ CENTRE PANEL â”€â”€ */
.panel-mid{background:var(--ink);display:flex;flex-direction:column;overflow:hidden;position:relative}
/* Corner marks */
.panel-mid::before,.panel-mid::after{content:'';position:absolute;z-index:0;width:44px;height:44px}
.panel-mid::before{top:1.2rem;left:1.2rem;border-left:1px solid rgba(200,164,74,.1);border-top:1px solid rgba(200,164,74,.1)}
.panel-mid::after{bottom:1.2rem;right:1.2rem;border-right:1px solid rgba(200,164,74,.1);border-bottom:1px solid rgba(200,164,74,.1)}

/* VIEWS inside centre */
.centre-view{position:relative;z-index:1;flex:1;display:none;flex-direction:column;overflow:hidden}
.centre-view.active{display:flex}

/* â”€â”€ IDLE VIEW (phone placeholder) â”€â”€ */
.idle-view{align-items:center;justify-content:center;gap:.9rem}
.phone-preview{width:180px;aspect-ratio:9/16;background:var(--smoke);border-radius:22px;
  border:1px solid rgba(255,255,255,.06);overflow:hidden;position:relative;flex-shrink:0;
  box-shadow:0 0 0 2px rgba(255,255,255,.02),0 20px 60px rgba(0,0,0,.65)}
.phone-preview::before{content:'';position:absolute;top:0;left:50%;transform:translateX(-50%);
  width:44px;height:4px;background:var(--ash);border-radius:0 0 4px 4px;z-index:5}
.phone-ph{width:100%;height:100%;display:flex;flex-direction:column;align-items:center;
  justify-content:center;gap:.6rem;padding:1.2rem}
.phone-ph .ph-icon{font-size:1.6rem;opacity:.15}
.phone-ph p{font-family:'Cormorant Garamond',serif;font-style:italic;font-size:.72rem;
  color:var(--fog);text-align:center;line-height:1.6}
.phone-loader{position:absolute;inset:0;display:flex;flex-direction:column;
  align-items:center;justify-content:center;gap:.65rem;background:rgba(7,7,8,.9);z-index:5}
.spinner{width:26px;height:26px;border:2px solid var(--veil);border-top-color:var(--gold);
  border-radius:50%;animation:spin .7s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.loader-txt{font-size:.54rem;letter-spacing:.16em;text-transform:uppercase;color:var(--fog);
  animation:pulse 1.3s ease-in-out infinite}
@keyframes pulse{0%,100%{opacity:.28}50%{opacity:1}}
.preview-video{width:100%;height:100%;object-fit:cover;border-radius:22px;display:block}
.preview-ctrls{display:flex;align-items:center;gap:.5rem;flex-wrap:wrap;justify-content:center}
.ctrl-btn{background:var(--smoke);border:1px solid rgba(255,255,255,.055);border-radius:2rem;
  color:var(--pale);padding:.28rem .75rem;font-family:'Syne',sans-serif;font-size:.58rem;
  font-weight:600;letter-spacing:.1em;text-transform:uppercase;cursor:pointer;transition:all .2s}
.ctrl-btn:hover{border-color:var(--gold);color:var(--gold)}
.preview-specs{display:flex;gap:.8rem;font-size:.52rem;letter-spacing:.12em;
  text-transform:uppercase;color:var(--fog)}

/* â”€â”€ OPTIONS VIEW (5x5 selection grid) â”€â”€ */
.options-view{padding:1.2rem;gap:1.2rem;overflow-y:auto}
.options-section-title{font-size:.54rem;font-weight:700;letter-spacing:.22em;
  text-transform:uppercase;color:var(--fog);display:flex;align-items:center;gap:.5rem;flex-shrink:0}
.options-section-title::after{content:'';flex:1;height:1px;background:rgba(255,255,255,.04)}

/* Script cards grid */
.scripts-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:.6rem;flex-shrink:0}
.script-card{
  background:var(--mist);border:1px solid rgba(255,255,255,.05);
  border-radius:var(--r-lg);padding:.75rem .8rem;cursor:pointer;
  transition:all .22s;position:relative;overflow:hidden;
  display:flex;flex-direction:column;gap:.4rem;
  box-shadow:0 2px 8px rgba(0,0,0,.3)}
.script-card::before{content:'';position:absolute;inset:0;border-radius:var(--r-lg);
  opacity:0;transition:opacity .22s;
  background:linear-gradient(135deg,rgba(200,164,74,.06),transparent)}
.script-card:hover{border-color:rgba(255,255,255,.1);transform:translateY(-1px);
  box-shadow:0 4px 16px rgba(0,0,0,.4)}
.script-card:hover::before{opacity:1}
.script-card.selected{border-color:var(--gold)!important;
  box-shadow:0 0 0 1px var(--gold),0 4px 20px rgba(200,164,74,.18)!important}
.script-card.selected::before{opacity:1}
.sc-idx{font-size:.46rem;font-weight:700;letter-spacing:.2em;text-transform:uppercase;
  color:var(--ghost);margin-bottom:.1rem}
.sc-line1{
  font-family:'Cormorant Garamond',serif;
  font-style:italic;
  font-size:.78rem;
  font-weight:300;
  color:var(--snow);
  line-height:1.4;

  display:-webkit-box;
  -webkit-line-clamp:2;
  -webkit-box-orient:vertical;
  overflow:hidden;
  line-clamp:2;
}

.sc-line2{
  font-family:'Cormorant Garamond',serif;
  font-style:italic;
  font-size:.7rem;
  font-weight:300;
  color:var(--pale);
  line-height:1.3;
  opacity:.8;

  display:-webkit-box;
  -webkit-line-clamp:2;
  -webkit-box-orient:vertical;
  overflow:hidden;
  line-clamp:2;
}
.sc-tag{font-size:.44rem;font-weight:700;letter-spacing:.14em;text-transform:uppercase;
  padding:.12rem .42rem;border-radius:2rem;border:1px solid;display:inline-flex;
  align-items:center;margin-top:.1rem;width:fit-content}
.sel-badge{position:absolute;top:.45rem;right:.45rem;width:14px;height:14px;
  border-radius:50%;background:var(--gold);display:flex;align-items:center;
  justify-content:center;font-size:.48rem;color:var(--ink);font-weight:700;
  opacity:0;transition:opacity .18s}
.script-card.selected .sel-badge{opacity:1}

/* Visual cards grid */
.visuals-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:.6rem;flex-shrink:0}
.visual-card{
  aspect-ratio:9/16;border-radius:var(--r-lg);overflow:hidden;cursor:pointer;
  position:relative;border:2px solid transparent;transition:all .22s;
  box-shadow:0 2px 8px rgba(0,0,0,.4);background:var(--mist)}
.visual-card video{width:100%;height:100%;object-fit:cover;display:block;
  border-radius:calc(var(--r-lg) - 2px)}
.visual-card:hover{border-color:rgba(255,255,255,.2);transform:scale(1.02)}
.visual-card.selected{border-color:var(--gold)!important;
  box-shadow:0 0 0 1px var(--gold),0 4px 20px rgba(200,164,74,.2)!important}
.visual-card.selected::after{content:'âœ“';position:absolute;top:.45rem;right:.45rem;
  width:16px;height:16px;border-radius:50%;background:var(--gold);
  display:flex;align-items:center;justify-content:center;
  font-size:.5rem;color:var(--ink);font-weight:700;
  animation:popIn .18s cubic-bezier(.34,1.56,.64,1)}
.visual-emo{position:absolute;bottom:.45rem;left:.45rem;
  font-size:.44rem;font-weight:700;letter-spacing:.14em;text-transform:uppercase;
  padding:.12rem .42rem;border-radius:2rem;background:rgba(7,7,8,.75);
  backdrop-filter:blur(4px);color:var(--pale)}
@keyframes popIn{from{transform:scale(0)}to{transform:scale(1)}}

/* Divider */
.options-divider{height:1px;background:rgba(255,255,255,.04);flex-shrink:0}

/* â”€â”€ RIGHT PANEL â€” CONSOLE â”€â”€ */
.panel-right{background:var(--ash);border-left:1px solid rgba(255,255,255,.035);
  display:flex;flex-direction:column;overflow:hidden}
.console-header{padding:.85rem 1.1rem .7rem;border-bottom:1px solid rgba(255,255,255,.04);
  display:flex;align-items:center;justify-content:space-between;flex-shrink:0}
.console-title{font-size:.54rem;font-weight:700;letter-spacing:.2em;text-transform:uppercase;
  color:var(--fog);display:flex;align-items:center;gap:.42rem}
.cdot{width:5px;height:5px;border-radius:50%;background:var(--ghost);transition:background .3s}
.cdot.active{background:#4ade80;animation:blink 1.1s ease-in-out infinite}
@keyframes blink{0%,100%{opacity:.35}50%{opacity:1}}
.clear-btn{background:none;border:none;color:var(--fog);font-size:.54rem;cursor:pointer;
  font-family:'Syne',sans-serif;letter-spacing:.1em;text-transform:uppercase}
.clear-btn:hover{color:var(--pale)}

/* Steps */
.steps-wrap{padding:.85rem 1.1rem .7rem;border-bottom:1px solid rgba(255,255,255,.04);flex-shrink:0}
.steps{display:flex;gap:2px;margin-bottom:.55rem}
.step-seg{flex:1;height:2.5px;border-radius:2px;background:var(--veil);transition:background .4s,box-shadow .4s}
.step-seg.done{background:var(--gold)}
.step-seg.active{background:var(--gold);box-shadow:0 0 7px rgba(200,164,74,.4);animation:segpulse 1s ease-in-out infinite}
@keyframes segpulse{0%,100%{opacity:.5}50%{opacity:1}}
.step-seg.error{background:var(--ember)}
.step-labels{display:flex;gap:2px}
.step-label{flex:1;font-size:.42rem;font-weight:600;letter-spacing:.07em;text-transform:uppercase;
  color:var(--ghost);text-align:center;transition:color .3s;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.step-label.done{color:var(--gold)}
.step-label.active{color:var(--gold2)}
.step-label.error{color:var(--ember)}

/* Download bar */
.dl-wrap{padding:0 1.1rem .6rem;flex-shrink:0;display:none}
.dl-bg{height:1.5px;background:var(--veil);border-radius:2px;overflow:hidden}
.dl-fill{height:100%;background:var(--teal);width:0;transition:width .2s;border-radius:2px}
.dl-lbl{font-size:.5rem;color:var(--fog);margin-top:.28rem;font-family:'JetBrains Mono',monospace}

/* Log */
.log-term{flex:1;overflow-y:auto;padding:.7rem 1.1rem;
  font-family:'JetBrains Mono',monospace;font-size:.6rem;line-height:1.75;
  scrollbar-width:thin;scrollbar-color:var(--veil) transparent}
.log-term::-webkit-scrollbar{width:3px}
.log-term::-webkit-scrollbar-thumb{background:var(--veil)}
.log-empty{color:var(--ghost);font-style:italic;font-size:.58rem;padding:.3rem 0}
.log-entry{display:flex;gap:.42rem;padding:.05rem 0;animation:logIn .18s ease}
@keyframes logIn{from{opacity:0;transform:translateY(2px)}}
.log-ts{color:var(--ghost);font-size:.5rem;flex-shrink:0;margin-top:.1rem}
.log-msg{flex:1;word-break:break-word}

/* Status bar */
.status-bar{padding:.5rem 1.1rem;border-top:1px solid rgba(255,255,255,.04);
  font-size:.54rem;letter-spacing:.06em;color:var(--fog);display:flex;align-items:center;
  gap:.42rem;flex-shrink:0;font-family:'JetBrains Mono',monospace;min-height:30px}

/* â”€â”€ MODAL â”€â”€ */
.modal-bg{display:none;position:fixed;inset:0;z-index:1000;background:rgba(4,4,5,.88);
  backdrop-filter:blur(12px);align-items:center;justify-content:center}
.modal-bg.open{display:flex}
.modal{background:var(--ash);border:1px solid rgba(255,255,255,.055);border-radius:var(--r-lg);
  padding:1.7rem;width:90%;max-width:380px;display:flex;flex-direction:column;gap:1rem;
  animation:modalIn .26s cubic-bezier(.34,1.56,.64,1)}
@keyframes modalIn{from{opacity:0;transform:scale(.92) translateY(12px)}}
.modal-title{font-family:'Cormorant Garamond',serif;font-size:1.2rem;font-style:italic;color:var(--snow)}
.modal-note{font-size:.62rem;color:var(--fog);line-height:1.65;background:rgba(255,255,255,.02);
  padding:.65rem;border-radius:var(--r);border-left:2px solid var(--gold)}
.modal-note code{color:var(--pale);font-family:'JetBrains Mono',monospace;font-size:.58rem}
.modal-row{display:flex;gap:.6rem}
.btn-cancel{flex:1;padding:.62rem;background:transparent;border:1px solid var(--ghost);
  border-radius:var(--r);color:var(--pale);font-family:'Syne',sans-serif;font-size:.62rem;
  font-weight:600;letter-spacing:.1em;text-transform:uppercase;cursor:pointer}
.btn-cancel:hover{border-color:var(--fog)}
.btn-auth{flex:2;padding:.62rem;background:var(--gold);border:none;border-radius:var(--r);
  color:var(--ink);font-family:'Syne',sans-serif;font-size:.62rem;font-weight:700;
  letter-spacing:.1em;text-transform:uppercase;cursor:pointer}
.btn-auth:hover{filter:brightness(1.1)}

/* â”€â”€ TOASTS â”€â”€ */
.toasts{position:fixed;bottom:1.3rem;right:1.3rem;z-index:9999;display:flex;flex-direction:column;gap:.35rem}
.toast{background:var(--smoke);border:1px solid rgba(255,255,255,.06);border-radius:.4rem;
  padding:.55rem .9rem;font-size:.62rem;color:var(--silk);display:flex;align-items:center;gap:.38rem;
  animation:toastIn .2s ease;max-width:260px;transition:opacity .4s}
.toast.ok{border-color:rgba(56,168,96,.3)}
.toast.err{border-color:rgba(224,85,48,.3)}
@keyframes toastIn{from{opacity:0;transform:translateY(6px)}}

.hidden{display:none!important}
.fade-in{animation:fadeIn .3s ease both}
@keyframes fadeIn{from{opacity:0;transform:translateY(4px)}}
</style>
</head>
<body>
<div class="app">

<!-- HEADER -->
<header>
  <div class="brand">
    <span class="brand-name">ShadowThakur</span>
    <span class="brand-sub">Cinematic Studio</span>
  </div>
  <div class="hdr-right">
    <div class="yt-pill" id="ytPill" onclick="openOAuth()">
      <div class="yt-dot" id="ytDot"></div>
      <span class="yt-lbl" id="ytLbl">YouTube</span>
    </div>
  </div>
</header>

<main>

<!-- LEFT PANEL -->
<div class="panel panel-left">

  <!-- API Keys -->
  <div>
    <div class="sec-label">API Keys</div>
    <div style="display:flex;flex-direction:column;gap:.7rem">
      <div class="field">
        <div class="flabel">Gemini Key</div>
        <div class="key-wrap">
          <input type="password" id="geminiKey" placeholder="AIzaâ€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"/>
          <button class="eye-btn" onclick="toggleKey('geminiKey')">&#128065;</button>
        </div>
      </div>
      <div class="field">
        <div class="flabel">Pexels Key</div>
        <div class="key-wrap">
          <input type="password" id="pexelsKey" placeholder="Pexelsâ€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"/>
          <button class="eye-btn" onclick="toggleKey('pexelsKey')">&#128065;</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Generate -->
  <div>
    <div class="sec-label">Generate</div>
    <button class="btn-gen" id="genBtn" onclick="startGen()">
      <div class="btn-gen-inner">&#10038; Generate 5 Options</div>
    </button>
  </div>

  <!-- Selection summary (shown during options phase) -->
  <div id="selSummarySec" class="hidden fade-in">
    <div class="sec-label">Your Selection</div>
    <div class="sel-summary">
      <div class="sel-row">
        <div class="sel-check" id="scriptCheck">&#10003;</div>
        <div style="flex:1;display:flex;flex-direction:column;gap:.18rem">
          <div class="flabel" style="color:var(--fog)">Script</div>
          <div class="sel-text empty" id="selScriptText">Choose a script card</div>
        </div>
      </div>
      <div class="sel-row">
        <div class="sel-check" id="visualCheck">&#10003;</div>
        <div style="flex:1;display:flex;flex-direction:column;gap:.18rem">
          <div class="flabel" style="color:var(--fog)">Visual</div>
          <div class="sel-text empty" id="selVisualText">Choose a visual clip</div>
        </div>
      </div>
    </div>
    <div style="margin-top:.7rem;display:flex;flex-direction:column;gap:.5rem">
      <button class="btn-render hidden" id="renderBtn" onclick="submitRender()">
        &#9654; Render Selected
      </button>
      <button class="btn-regen" id="regenBtn" onclick="startGen()">&#8635; New Options</button>
    </div>
  </div>

  <!-- Post-render script display -->
  <div id="metaSec" class="hidden fade-in">
    <div class="sec-label">Script</div>
    <div class="meta-card">
      <div>
        <div class="script-l" id="ml1"></div>
        <div class="script-l" id="ml2" style="padding-left:.7rem;opacity:.78;margin-top:.2rem"></div>
      </div>
      <div class="meta-tags"><span class="tag" id="emoTag">â€”</span></div>
      <div style="display:flex;flex-direction:column;gap:.2rem">
        <div class="meta-row"><strong>Scene:</strong> <span id="mScene">â€”</span></div>
        <div class="meta-row"><strong>Light:</strong> <span id="mLight">â€”</span></div>
      </div>
    </div>
    <button class="btn-regen" style="margin-top:.65rem" onclick="startGen()">&#8635; Generate New Options</button>
  </div>

  <!-- Upload -->
  <div id="uploadSec" class="hidden fade-in">
    <div class="sec-label">Upload to YouTube</div>
    <div style="display:flex;flex-direction:column;gap:.6rem">
      <div class="field"><div class="flabel">Title</div><input type="text" id="ytTitle" placeholder="DiaryOfJazbaat Short"/></div>
      <div class="field"><div class="flabel">Description</div><input type="text" id="ytDesc" placeholder="#Shorts #DiaryOfJazbaat"/></div>
      <div class="field">
        <div class="flabel">Privacy</div>
        <select id="ytPrivacy"><option value="public">Public</option><option value="unlisted">Unlisted</option><option value="private">Private</option></select>
      </div>
      <button class="btn-upload" id="uploadBtn" onclick="doUpload()">
        <svg width="14" height="10" viewBox="0 0 18 14" fill="none"><path d="M17.6 2.2C17.4 1.5 16.9 1 16.2.8 14.8.5 9 .5 9 .5s-5.8 0-7.2.3C1.1 1 .6 1.5.4 2.2.1 3.6.1 7 .1 7s0 3.4.3 4.8c.2.7.7 1.2 1.4 1.4C3.2 13.5 9 13.5 9 13.5s5.8 0 7.2-.3c.7-.2 1.2-.7 1.4-1.4.3-1.4.3-4.8.3-4.8s0-3.4-.3-4.8Z" fill="currentColor"/><path d="M7.2 9.9L11.8 7 7.2 4.1v5.8Z" fill="#cc0000"/></svg>
        Upload to Shorts
      </button>
      <div id="uploadResult" class="upload-result hidden"></div>
    </div>
  </div>

</div><!-- /panel-left -->

<!-- CENTRE PANEL -->
<div class="panel-mid">

  <!-- IDLE VIEW -->
  <div class="centre-view idle-view active" id="idleView">
    <div class="phone-preview" id="phone">
      <div class="phone-ph" id="phonePH">
        <div class="ph-icon">&#11042;</div>
        <p>Generate 5 scripts<br/>+ visuals to begin</p>
      </div>
      <div class="phone-loader hidden" id="phoneLoader">
        <div class="spinner"></div>
        <div class="loader-txt" id="loaderTxt">Starting...</div>
      </div>
      <video class="preview-video hidden" id="prevVid" loop playsinline muted></video>
    </div>
    <div class="preview-ctrls hidden" id="prevCtrls">
      <button class="ctrl-btn" id="ppBtn" onclick="togglePlay()">&#9654; Play</button>
      <button class="ctrl-btn" onclick="dlVideo()">&#8595; Download</button>
    </div>
    <div class="preview-specs hidden" id="prevSpecs">
      <span>8s</span><span>9:16</span><span>Silent</span>
    </div>
  </div>

  <!-- OPTIONS VIEW: 5 scripts + 5 visuals -->
  <div class="centre-view options-view panel" id="optionsView">

    <div class="options-section-title">Choose a Script</div>
    <div class="scripts-grid" id="scriptsGrid"></div>

    <div class="options-divider"></div>

    <div class="options-section-title">Choose a Visual</div>
    <div class="visuals-grid" id="visualsGrid"></div>

  </div>

  <!-- RENDERING VIEW: phone with loader -->
  <div class="centre-view idle-view" id="renderingView">
    <div class="phone-preview">
      <div class="phone-loader" style="display:flex">
        <div class="spinner"></div>
        <div class="loader-txt" id="renderLoaderTxt">Rendering...</div>
      </div>
    </div>
  </div>

</div><!-- /panel-mid -->

<!-- RIGHT â€” CONSOLE -->
<div class="panel-right">
  <div class="console-header">
    <div class="console-title">
      <div class="cdot" id="consoleDot"></div>
      Pipeline Console
    </div>
    <button class="clear-btn" onclick="clearLogs()">clear</button>
  </div>

  <div class="steps-wrap">
    <div class="steps">
      <div class="step-seg" id="seg0"></div>
      <div class="step-seg" id="seg1"></div>
      <div class="step-seg" id="seg2"></div>
      <div class="step-seg" id="seg3"></div>
      <div class="step-seg" id="seg4"></div>
      <div class="step-seg" id="seg5"></div>
    </div>
    <div class="step-labels">
      <div class="step-label" id="lbl0">Scripts</div>
      <div class="step-label" id="lbl1">Visuals</div>
      <div class="step-label" id="lbl2">Options</div>
      <div class="step-label" id="lbl3">Render</div>
      <div class="step-label" id="lbl4">Encode</div>
      <div class="step-label" id="lbl5">Done</div>
    </div>
  </div>

  <div class="dl-wrap" id="dlWrap">
    <div class="dl-bg"><div class="dl-fill" id="dlFill"></div></div>
    <div class="dl-lbl" id="dlLbl">Downloading...</div>
  </div>

  <div class="log-term" id="logTerm">
    <div class="log-empty">Waiting for pipeline to start...</div>
  </div>

  <div class="status-bar">
    <span>&#9702;</span>
    <span id="statusMsg">Idle â€” enter API keys and generate</span>
  </div>
</div>

</main>
</div>

<!-- YouTube OAuth Modal -->
<div class="modal-bg" id="oauthModal">
  <div class="modal">
    <div class="modal-title">Connect YouTube</div>
    <div class="modal-note">
      Enable <strong>YouTube Data API v3</strong>, create OAuth 2.0 Web Application credentials. Set redirect URI:<br/>
      <code>http://localhost:5000/api/oauth/callback</code>
    </div>
    <div style="display:flex;flex-direction:column;gap:.6rem">
      <div class="field"><div class="flabel">Client ID</div><input type="text" id="oaClientId" placeholder="xxxx.apps.googleusercontent.com"/></div>
      <div class="field"><div class="flabel">Client Secret</div>
        <div class="key-wrap"><input type="password" id="oaSecret" placeholder="GOCSPX-..."/><button class="eye-btn" onclick="toggleKey('oaSecret')">&#128065;</button></div>
      </div>
    </div>
    <div class="modal-row">
      <button class="btn-cancel" onclick="closeOAuth()">Cancel</button>
      <button class="btn-auth" onclick="doOAuth()">Authenticate &#8594;</button>
    </div>
  </div>
</div>

<div class="toasts" id="toasts"></div>

<script>
const API = window.location.origin;
let jobId = null, pollTimer = null, ytOk = false, lastLogCount = 0;
let selectedScript = null, selectedVisual = null;
let currentScripts = [], currentVisuals = [];

// â”€â”€ Step map â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const STEP_MAP = {
  queued:             [0, false],
  generating_scripts: [0, true],
  fetching_visuals:   [1, true],
  options_ready:      [2, false],
  rendering:          [3, true],
  encoding:           [4, true],
  done:               [5, false],
  error:              [-1, false],
};

// â”€â”€ Utils â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function esc(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;') }
function toggleKey(id){ const e=document.getElementById(id); e.type=e.type==='password'?'text':'password' }
function setStatus(msg){ document.getElementById('statusMsg').textContent = msg }
function showView(id){
  ['idleView','optionsView','renderingView'].forEach(v=>{
    document.getElementById(v).classList.toggle('active', v===id)
  })
}

function toast(msg, type='info'){
  const c = document.getElementById('toasts');
  const el = document.createElement('div');
  el.className = 'toast'+(type==='error'?' err':type==='success'?' ok':'');
  const ic = type==='error'?'&#10005;':type==='success'?'&#10003;':'&#9702;';
  const col = type==='error'?'var(--ember)':type==='success'?'var(--green)':'var(--gold)';
  el.innerHTML = `<span style="color:${col}">${ic}</span> ${esc(msg)}`;
  c.appendChild(el);
  setTimeout(()=>{ el.style.opacity='0'; setTimeout(()=>el.remove(),400) }, 3000);
}

// â”€â”€ Log terminal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function appendLog(msg){
  const term = document.getElementById('logTerm');
  const empty = term.querySelector('.log-empty');
  if(empty) empty.remove();
  const now = new Date();
  const ts = `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}:${String(now.getSeconds()).padStart(2,'0')}`;
  let col = 'var(--pale)';
  if(/^âœ…|^ğŸš€/.test(msg)) col='var(--green)';
  else if(/^ğŸ’¥|^âŒ|^âš /.test(msg)) col='var(--ember)';
  else if(/^ğŸ¨|^âš™|^â¬‡|^ğŸ§ |^ğŸ“/.test(msg)) col='var(--gold)';
  else if(/^\s+\[/.test(msg)) col='var(--fog)';
  const entry = document.createElement('div');
  entry.className = 'log-entry';
  entry.innerHTML = `<span class="log-ts">${ts}</span><span class="log-msg" style="color:${col}">${esc(msg)}</span>`;
  term.appendChild(entry);
  term.scrollTop = term.scrollHeight;
}
function clearLogs(){
  document.getElementById('logTerm').innerHTML = '<div class="log-empty">Console cleared.</div>';
  lastLogCount = 0;
}

// â”€â”€ Steps â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateSteps(status){
  const [ai, isActive] = STEP_MAP[status] || [0, false];
  const isErr = status === 'error';
  const isDone = status === 'done';
  for(let i=0; i<=5; i++){
    const seg = document.getElementById('seg'+i);
    const lbl = document.getElementById('lbl'+i);
    seg.className = 'step-seg'; lbl.className = 'step-label';
    if(isErr){ if(i<=Math.max(ai,0)){ seg.classList.add('error'); lbl.classList.add('error') } }
    else if(isDone){ seg.classList.add('done'); lbl.classList.add('done') }
    else if(i < ai){ seg.classList.add('done'); lbl.classList.add('done') }
    else if(i === ai && isActive){ seg.classList.add('active'); lbl.classList.add('active') }
    else if(i === ai){ seg.classList.add('done'); lbl.classList.add('done') }
  }
  const dot = document.getElementById('consoleDot');
  isActive && !isErr && !isDone ? dot.classList.add('active') : dot.classList.remove('active');
}

// â”€â”€ Script + Visual selection â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function selectScript(idx){
  selectedScript = currentScripts[idx];
  document.querySelectorAll('.script-card').forEach((c,i)=>{
    c.classList.toggle('selected', i===idx);
    c.querySelector('.sel-badge').style.opacity = i===idx ? '1' : '0';
  });
  const s = selectedScript;
  const el = document.getElementById('selScriptText');
  el.textContent = `"${s.Line1}" â€” ${s.Emotion}`;
  el.classList.remove('empty');
  document.getElementById('scriptCheck').classList.add('done');
  checkRenderReady();
}

function selectVisual(idx){
  selectedVisual = currentVisuals[idx];
  document.querySelectorAll('.visual-card').forEach((c,i)=>{
    c.classList.toggle('selected', i===idx);
  });
  const el = document.getElementById('selVisualText');
  el.textContent = `Clip ${idx+1} â€” ${selectedVisual.emotion}`;
  el.classList.remove('empty');
  document.getElementById('visualCheck').classList.add('done');
  checkRenderReady();
}

function checkRenderReady(){
  const btn = document.getElementById('renderBtn');
  if(selectedScript && selectedVisual){
    btn.classList.remove('hidden');
  }
}

// â”€â”€ Build options grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const EMOTION_COLORS = {
  Pain:'tag-Pain', Realization:'tag-Realization', Growth:'tag-Growth', Ego:'tag-Ego', Calm:'tag-Calm'
};

function buildOptionsGrid(scripts, visuals){
  currentScripts = scripts;
  currentVisuals = visuals;
  selectedScript = null;
  selectedVisual = null;

  // Scripts
  const sg = document.getElementById('scriptsGrid');
  sg.innerHTML = '';
  scripts.forEach((s, i)=>{
    const card = document.createElement('div');
    card.className = 'script-card';
    card.onclick = ()=>selectScript(i);
    const tagClass = EMOTION_COLORS[s.Emotion] || '';
    card.innerHTML = `
      <div class="sc-idx">Script ${i+1}</div>
      <div class="sc-line1">"${esc(s.Line1)}"</div>
      <div class="sc-line2">${esc(s.Line2)}</div>
      <span class="sc-tag ${tagClass}">${esc(s.Emotion)}</span>
      <div class="sel-badge">&#10003;</div>`;
    sg.appendChild(card);
  });

  // Visuals
  const vg = document.getElementById('visualsGrid');
  vg.innerHTML = '';
  visuals.forEach((v, i)=>{
    const card = document.createElement('div');
    card.className = 'visual-card';
    card.onclick = ()=>selectVisual(i);
    const videoUrl = `${API}/api/visual/${jobId}/${v.slot}`;
    card.innerHTML = `
      <video src="${videoUrl}" loop muted autoplay playsinline preload="auto"></video>
      <div class="visual-emo">${esc(v.emotion)}</div>`;
    vg.appendChild(card);
  });

  // Reset selection summary
  document.getElementById('selScriptText').textContent = 'Choose a script card';
  document.getElementById('selScriptText').classList.add('empty');
  document.getElementById('selVisualText').textContent = 'Choose a visual clip';
  document.getElementById('selVisualText').classList.add('empty');
  document.getElementById('scriptCheck').classList.remove('done');
  document.getElementById('visualCheck').classList.remove('done');
  document.getElementById('renderBtn').classList.add('hidden');
  document.getElementById('selSummarySec').classList.remove('hidden');
  document.getElementById('metaSec').classList.add('hidden');
  document.getElementById('uploadSec').classList.add('hidden');

  showView('optionsView');
  setStatus('Options ready â€” choose a script and visual, then render');
}

// â”€â”€ Render selected â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function submitRender(){
  if(!selectedScript || !selectedVisual){ toast('Select both a script and a visual first.', 'error'); return }
  const btn = document.getElementById('renderBtn');
  btn.disabled = true;
  btn.textContent = 'â³ Starting render...';

  // Switch to rendering view
  showView('renderingView');
  appendLog('ğŸ¬ Submitting render job...');
  setStatus('Rendering selected script + visual...');

  try{
    const r = await fetch(`${API}/api/render-selected`,{
      method:'POST', credentials:'include',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({
        job_id: jobId,
        selected_script: selectedScript,
        selected_visual: selectedVisual,
      })
    });
    const d = await r.json();
    if(d.error) throw new Error(d.error);
    startPoll(); // resume polling for render progress
  }catch(e){
    toast(e.message, 'error');
    showView('optionsView');
    btn.disabled = false;
    btn.innerHTML = '&#9654; Render Selected';
  }
}

// â”€â”€ Polling â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const STATUS_LABELS = {
  generating_scripts: 'Generating 5 cinematic scripts via Gemini...',
  fetching_visuals:   'Fetching 5 cinematic visuals from Pexels...',
  options_ready:      'Options ready â€” select script + visual',
  rendering:          'Rendering cinematic short...',
  encoding:           'Encoding H.264 video...',
  done:               'Done â€” preview and upload!',
  error:              'Pipeline error â€” see console',
};
const LOADER_LABELS = {
  generating_scripts: 'Writing scripts...',
  fetching_visuals:   'Fetching visuals...',
  rendering:          'Rendering (~30-60s)...',
  encoding:           'Encoding H.264...',
};

async function doPoll(){
  if(!jobId) return;
  try{
    const r = await fetch(`${API}/api/status/${jobId}`,{credentials:'include'});
    const job = await r.json();

    // Logs
    const logs = job.logs || [];
    if(logs.length > lastLogCount){
      logs.slice(lastLogCount).forEach(l=>appendLog(l.msg));
      lastLogCount = logs.length;
    }

    // Steps
    updateSteps(job.status);
    // ğŸ”¥ Render progress percentage
    if (job.status === "rendering" && job.progress !== undefined) {
      document.getElementById('renderLoaderTxt').textContent =
      `Rendering... ${job.progress}%`;
}
    if(STATUS_LABELS[job.status]) setStatus(STATUS_LABELS[job.status]);

    // Download progress
    const dlPcts = Object.keys(job).filter(k=>k.startsWith('dl_pct_')).map(k=>job[k]);
    if(dlPcts.length && job.status==='fetching_visuals'){
      const avg = Math.round(dlPcts.reduce((a,b)=>a+b,0)/dlPcts.length);
      document.getElementById('dlWrap').style.display='block';
      document.getElementById('dlFill').style.width = avg+'%';
      document.getElementById('dlLbl').textContent = `Downloading visuals... ${avg}%`;
    } else {
      document.getElementById('dlWrap').style.display='none';
    }

    // Render loader text
    // Render progress
  if(job.status === 'rendering'){
      if(job.progress !== undefined){
        document.getElementById('loaderTxt').textContent =
        `Rendering... ${job.progress}%`;
  }
  else {
        document.getElementById('loaderTxt').textContent =
        'Rendering...';
    }
  }
  else if(LOADER_LABELS[job.status]){
    document.getElementById('loaderTxt').textContent =
        LOADER_LABELS[job.status];
}

    // State transitions
    if(job.status === 'options_ready'){
      clearInterval(pollTimer);
      document.getElementById('genBtn').disabled = false;
      buildOptionsGrid(job.scripts || [], job.visuals || []);
    }
    else if(job.status === 'done'){
      clearInterval(pollTimer);
      await onRenderDone(job);
    }
    else if(job.status === 'error'){
      clearInterval(pollTimer);
      document.getElementById('genBtn').disabled = false;
      document.getElementById('renderBtn').disabled = false;
      document.getElementById('renderBtn').innerHTML = '&#9654; Render Selected';
      const shortErr = (job.error||'').trim().split('').pop()||'Unknown error';
      setStatus('Error: '+shortErr);
      toast('Pipeline failed â€” check the console', 'error');
      showView('idleView');
    }
  }catch(e){}
}
function startPoll(){ if(pollTimer) clearInterval(pollTimer); pollTimer = setInterval(doPoll, 900) }

// â”€â”€ Generation start â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function startGen(){
  const gk = document.getElementById('geminiKey').value.trim();
  const pk = document.getElementById('pexelsKey').value.trim();
  if(!gk||!pk){ toast('Enter both API keys first.','error'); return }

  // Reset UI
  selectedScript = null; selectedVisual = null;
  document.getElementById('logTerm').innerHTML = '<div class="log-empty">Pipeline starting...</div>';
  lastLogCount = 0;
  document.getElementById('genBtn').disabled = true;
  document.getElementById('selSummarySec').classList.add('hidden');
  document.getElementById('metaSec').classList.add('hidden');
  document.getElementById('uploadSec').classList.add('hidden');
  document.getElementById('renderBtn').classList.add('hidden');
  document.getElementById('dlWrap').style.display='none';
  for(let i=0;i<=5;i++){
    document.getElementById('seg'+i).className='step-seg';
    document.getElementById('lbl'+i).className='step-label';
  }
  showView('idleView');
  document.getElementById('phonePH').classList.remove('hidden');
  document.getElementById('prevVid').classList.add('hidden');
  document.getElementById('prevCtrls').classList.add('hidden');
  document.getElementById('prevSpecs').classList.add('hidden');
  document.getElementById('phoneLoader').classList.add('hidden');

  setStatus('Sending request to Gemini AI...');

  try{
    const r = await fetch(`${API}/api/generate`,{
      method:'POST', credentials:'include',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({gemini_key:gk, pexels_key:pk})
    });
    const d = await r.json();
    if(d.error) throw new Error(d.error);
    jobId = d.job_id;
    lastLogCount = 0;
    startPoll();
  }catch(e){
    document.getElementById('genBtn').disabled = false;
    toast(e.message,'error');
    setStatus('Request failed: '+e.message);
  }
}

// â”€â”€ Render done â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function onRenderDone(job){
  showView('idleView');
  document.getElementById('genBtn').disabled = false;
  document.getElementById('selSummarySec').classList.add('hidden');

  // Show video in phone
  const vid = document.getElementById('prevVid');
  vid.src = `${API}/api/preview/${jobId}?t=${Date.now()}`;
  vid.classList.remove('hidden');
  document.getElementById('phonePH').classList.add('hidden');
  document.getElementById('phoneLoader').classList.add('hidden');
  document.getElementById('prevCtrls').classList.remove('hidden');
  document.getElementById('prevSpecs').classList.remove('hidden');
  vid.play().catch(()=>{});
  document.getElementById('ppBtn').textContent = 'â¸ Pause';

  // Show meta
  if(job.metadata){
    const m = job.metadata;
    document.getElementById('metaSec').classList.remove('hidden');
    document.getElementById('ml1').textContent = 'â€œ'+m.Line1+'â€';
    document.getElementById('ml2').textContent = m.Line2;
    const tag = document.getElementById('emoTag');
    tag.textContent = m.Emotion; tag.className = 'tag tag-'+m.Emotion;
    document.getElementById('mScene').textContent = m.Scene||'â€”';
    document.getElementById('mLight').textContent = m.Lighting||'â€”';
    document.getElementById('ytTitle').value = `${m.Line1} ${m.Line2} #Shorts`;
    document.getElementById('ytDesc').value   = `${m.Line1}
${m.Line2}

#Shorts #DiaryOfJazbaat #${m.Emotion}`;
  }
  document.getElementById('uploadSec').classList.remove('hidden');
  toast('Render complete! Preview, then upload or regenerate.','success');
}

// â”€â”€ Video controls â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function togglePlay(){
  const v=document.getElementById('prevVid'),b=document.getElementById('ppBtn');
  if(v.paused){v.play();b.textContent='â¸ Pause';}else{v.pause();b.textContent='â–¶ Play';}
}
function dlVideo(){
  if(!jobId)return;
  const a=document.createElement('a');a.href=`${API}/api/preview/${jobId}`;
  a.download='jazbaat_short.mp4';a.click();
}

// â”€â”€ YouTube OAuth â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openOAuth(){ document.getElementById('oauthModal').classList.add('open') }
function closeOAuth(){ document.getElementById('oauthModal').classList.remove('open') }

async function doOAuth(){
  const cid=document.getElementById('oaClientId').value.trim();
  const sec=document.getElementById('oaSecret').value.trim();
  if(!cid||!sec){toast('Paste Client ID and Secret.','error');return}
  try{
    const r=await fetch(`${API}/api/oauth/start`,{method:'POST',credentials:'include',
      headers:{'Content-Type':'application/json'},body:JSON.stringify({client_id:cid,client_secret:sec})});
    const d=await r.json();if(d.error)throw new Error(d.error);
    const popup=window.open(d.auth_url,'yt_auth','width=500,height=620,toolbar=no');
    window.addEventListener('message',function h(e){
      if(e.data&&e.data.type==='yt_auth_done'){
        window.removeEventListener('message',h);closeOAuth();checkYT();toast('YouTube connected!','success');}
    });
  }catch(e){toast(e.message,'error')}
}

async function checkYT(){
  try{
    const r=await fetch(`${API}/api/yt/status`,{credentials:'include'});
    const d=await r.json();ytOk=d.connected;
    const pill=document.getElementById('ytPill'),dot=document.getElementById('ytDot'),lbl=document.getElementById('ytLbl');
    dot.className='yt-dot'+(ytOk?' on':'');
    lbl.textContent=ytOk?'Connected':'YouTube';
    pill.className='yt-pill'+(ytOk?' on':'');
  }catch(e){}
}

// â”€â”€ Upload â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function doUpload(){
  if(!ytOk){openOAuth();return}
  if(!jobId){toast('Generate and render a video first.','error');return}
  const btn=document.getElementById('uploadBtn'),res=document.getElementById('uploadResult');
  btn.disabled=true;
  btn.innerHTML='<div class="spinner" style="width:12px;height:12px;border-width:1.5px"></div> Uploading...';
  res.classList.add('hidden');
  try{
    const r=await fetch(`${API}/api/upload`,{method:'POST',credentials:'include',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({job_id:jobId,
        title:document.getElementById('ytTitle').value||'DiaryOfJazbaat Short',
        description:document.getElementById('ytDesc').value||'#Shorts',
        tags:['Shorts','DiaryOfJazbaat','emotional','cinematic'],
        privacy:document.getElementById('ytPrivacy').value})});
    const d=await r.json();if(d.error)throw new Error(d.error);
    res.className='upload-result ok';
    res.innerHTML='Uploaded! <a href="'+d.url+'" target="_blank" style="color:var(--green);text-decoration:underline">'+d.url+'</a>';
    res.classList.remove('hidden');
    appendLog('ğŸš€ Uploaded: '+d.url);
    toast('Uploaded to YouTube Shorts!','success');
  }catch(e){
    res.className='upload-result err';res.textContent='Failed: '+e.message;res.classList.remove('hidden');
    toast(e.message,'error');
  }finally{
    btn.disabled=false;
    btn.innerHTML='<svg width="14" height="10" viewBox="0 0 18 14" fill="none"><path d="M17.6 2.2C17.4 1.5 16.9 1 16.2.8 14.8.5 9 .5 9 .5s-5.8 0-7.2.3C1.1 1 .6 1.5.4 2.2.1 3.6.1 7 .1 7s0 3.4.3 4.8c.2.7.7 1.2 1.4 1.4C3.2 13.5 9 13.5 9 13.5s5.8 0 7.2-.3c.7-.2 1.2-.7 1.4-1.4.3-1.4.3-4.8.3-4.8s0-3.4-.3-4.8Z" fill="currentColor"/><path d="M7.2 9.9L11.8 7 7.2 4.1v5.8Z" fill="#cc0000"/></svg> Upload to Shorts';
  }
}

// â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
checkYT();
setInterval(checkYT, 30000);
['geminiKey','pexelsKey'].forEach(k=>{
  const s=sessionStorage.getItem(k);if(s)document.getElementById(k).value=s;
  document.getElementById(k).addEventListener('input',e=>sessionStorage.setItem(k,e.target.value));
});
</script>
</body>
</html>